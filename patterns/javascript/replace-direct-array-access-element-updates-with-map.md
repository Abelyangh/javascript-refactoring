Replace direct array access element updates with map
=====================================================
